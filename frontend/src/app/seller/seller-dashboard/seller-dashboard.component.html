<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Panel del Vendedor</h1>
    <p>Bienvenido de nuevo, {{ currentUser?.firstName }} {{ currentUser?.lastName }}</p>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="icon-users"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.totalClients }}</h3>
        <p>Total de Clientes</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="icon-active"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.activeClients }}</h3>
        <p>Clientes Activos</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="icon-money"></i>
      </div>
      <div class="stat-content">
        <h3>${{ stats.totalPayments | number:'1.0-0' }}</h3>
        <p>Total de Pagos</p>
      </div>
    </div>

    <div class="stat-card" [class.alert]="stats.overduePayments > 0">
      <div class="stat-icon">
        <i class="icon-alert"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.overduePayments }}</h3>
        <p>Pagos Vencidos</p>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- Assigned Clients Section -->
    <div class="section">
      <div class="section-header">
        <h2>Mis Clientes Asignados ({{ assignedClients.length }})</h2>
        <button class="btn btn-outline" routerLink="/seller/clients">
          Ver Todos
        </button>
      </div>

      <div class="clients-grid">
        <div class="client-card" *ngFor="let client of assignedClients.slice(0, 6)">
          <div class="client-header">
            <div class="client-name">
              <h4>{{ client.firstName }} {{ client.lastName }}</h4>
              <span class="status-badge" [ngClass]="getStatusClass(client)">
                {{ getClientStatus(client) }}
              </span>
            </div>
            <div class="client-contact">
              <p>{{ client.email }}</p>
              <p *ngIf="client.phone">{{ client.phone }}</p>
            </div>
          </div>

          <div class="client-property">
            <h5>{{ client.property_title }}</h5>
            <p *ngIf="client.real_estate_name">{{ client.real_estate_name }}</p>
          </div>

          <div class="client-payment" *ngIf="client.total_down_payment > 0">
            <div class="progress-container">
              <div class="progress-bar">
                <div
                  class="progress-fill"
                  [style.width.%]="getPaymentProgress(client)">
                </div>
              </div>
              <div class="progress-text">
                {{ getPaymentProgress(client) }}% Completado
              </div>
            </div>
            <div class="payment-details">
              <span>Total: ${{ client.total_down_payment | number:'1.0-0' }}</span>
              <span>Restante: ${{ client.remaining_balance | number:'1.0-0' }}</span>
            </div>
          </div>

          <div class="client-actions">
            <a class="btn btn-sm btn-primary" [routerLink]="['/seller/clients', client.id]">
              Ver Detalles
            </a>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="assignedClients.length === 0 && !loading">
        <i class="icon-users"></i>
        <h3>Sin Clientes Asignados</h3>
        <p>AÃºn no tienes clientes asignados.</p>
      </div>
    </div>

    <!-- Notifications Section -->
    <div class="section">
      <div class="section-header">
        <h2>Notificaciones Recientes</h2>
        <span class="notification-count" *ngIf="getUnreadNotificationsCount() > 0">
          {{ getUnreadNotificationsCount() }} sin leer
        </span>
      </div>

      <div class="notifications-list">
        <div
          class="notification-item"
          *ngFor="let notification of notifications"
          [class.unread]="!notification.is_read"
          (click)="markNotificationAsRead(notification.id)">

          <div class="notification-icon">
            <i [ngClass]="getNotificationIcon(notification.type)"></i>
          </div>

          <div class="notification-content">
            <div class="notification-header">
              <h4>{{ notification.title }}</h4>
              <span class="notification-time">{{ notification.created_at | date:'short' }}</span>
            </div>
            <p>{{ notification.message }}</p>
            <p *ngIf="notification.client_name" class="client-reference">
              Client: {{ notification.client_name }}
            </p>
          </div>

          <div class="notification-status" *ngIf="!notification.is_read">
            <span class="unread-indicator"></span>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="notifications.length === 0 && !loading">
        <i class="icon-bell"></i>
        <h3>No Notifications</h3>
        <p>You don't have any notifications yet.</p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="section">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        <div class="action-card">
          <div class="action-icon">
            <i class="icon-users"></i>
          </div>
          <h3>View All Clients</h3>
          <p>Manage all clients across real estates</p>
          <button class="btn btn-primary" routerLink="/seller/clients">
            View Clients
          </button>
        </div>

        <div class="action-card">
          <div class="action-icon">
            <i class="icon-reports"></i>
          </div>
          <h3>Payment Reports</h3>
          <p>View payment status and overdue clients</p>
          <button class="btn btn-primary" routerLink="/seller/reports">
            View Reports
          </button>
        </div>

        <div class="action-card">
          <div class="action-icon">
            <i class="icon-bell"></i>
          </div>
          <h3>All Notifications</h3>
          <p>View all your notifications</p>
          <button class="btn btn-secondary" routerLink="/seller/notifications">
            View All
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
  </div>
</div>
